<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè• Monitoramento de Pacientes</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div class="container">
        <h1>Sistema de Monitoramento de Pacientes</h1>
        
        <form id="patientForm">
            <h2>Registro de Dados</h2>
            <div>
                <label for="id">ID do Paciente:</label>
                <input type="text" id="id" name="id" required>
            </div>
            <div>
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" required>
            </div>
            <div>
                <label for="idade">Idade:</label>
                <input type="number" id="idade" name="idade" min="0" required>
            </div>
            <div>
                <label for="imc">IMC (√çndice de Massa Corporal):</label>
                <input type="number" id="imc" name="imc" step="0.1" required>
            </div>
            <div>
                <label for="sistolica">Press√£o Sist√≥lica (mmHg):</label>
                <input type="number" id="sistolica" name="sistolica" min="50" required>
            </div>
            <button type="submit">Adicionar Paciente</button>
        </form>

        <hr>

        <h2>Pacientes Monitorados</h2>
        <table id="patientTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Idade</th>
                    <th>IMC</th>
                    <th>Press√£o Sist√≥lica</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>P001</td>
                    <td>Mauro Nunes</td>
                    <td>45</td>
                    <td>25.5</td>
                    <td>120</td>
                </tr>
                <tr>
                    <td>P002</td>
                    <td>Armando Torres</td>
                    <td>62</td>
                    <td>31.2</td>
                    <td>145</td>
                </tr>
            </tbody>
        </table>
    </div>
    
</body>
</html>

<?php
// Nome do arquivo JSON
$arquivo = "pacientes.json";
$pacientes = [];
$mensagem = "";

// Carregar dados existentes
if (file_exists($arquivo)) {
    $conteudo = file_get_contents($arquivo);
    $dados = json_decode($conteudo, true);

    if ($dados !== null) {
        $pacientes = $dados;
    } else {
        $mensagem = "Erro: Arquivo JSON corrompido. Iniciando vazio.";
        $pacientes = [];
    }
}

// Fun√ß√£o para salvar no JSON
function salvarPacientes($pacientes, $arquivo) {
    global $mensagem;
    if (file_put_contents($arquivo, json_encode($pacientes, JSON_PRETTY_PRINT)) === false) {
        $mensagem = "Erro ao salvar dados.";
        return false;
    }
    return true;
}

// A√ß√µes CRUD
if ($_SERVER["REQUEST_METHOD"] === "POST") {
    $acao = $_POST['acao'] ?? '';
    $id = $_POST['id'] ?? '';

    if ($acao === "adicionar" || $acao === "editar") {
        if (!isset($_POST["nome"], $_POST["idade"], $_POST["imc"], $_POST["sistolica"]) || empty($id)) {
            $mensagem = "Erro: Todos os campos s√£o obrigat√≥rios.";
        } else {
            $novoPaciente = [
                "id" => htmlspecialchars(trim($id)),
                "nome" => htmlspecialchars(trim($_POST["nome"])),
                "idade" => (int)$_POST["idade"],
                "imc" => (float)$_POST["imc"],
                "sistolica" => (int)$_POST["sistolica"]
            ];

            if ($acao === "adicionar") {
                foreach ($pacientes as $p) {
                    if ($p['id'] === $novoPaciente['id']) {
                        $mensagem = "ID j√° existe.";
                        break;
                    }
                }

                if (empty($mensagem)) {
                    $pacientes[] = $novoPaciente;
                    salvarPacientes($pacientes, $arquivo);
                }

            } elseif ($acao === "editar") {
                foreach ($pacientes as $i => $p) {
                    if ($p['id'] === $novoPaciente['id']) {
                        $pacientes[$i] = $novoPaciente;
                        salvarPacientes($pacientes, $arquivo);
                        break;
                    }
                }
            }
        }
    } elseif ($acao === "excluir") {
        $idParaExcluir = trim($_POST['id_excluir']);
        $pacientes = array_values(array_filter($pacientes, fn($p) => $p['id'] !== $idParaExcluir));
        salvarPacientes($pacientes, $arquivo);
    }

    header("Location: index.php");
    exit;
}
?>
crud
